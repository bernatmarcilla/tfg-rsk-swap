<template>
    <div class="row">
    <card type="chart">
          <template slot="header">
            <h3 class="card-title"><i class="tim-icons icon-coins"></i> TokenA Liquidity Pool</h3>
          </template>
          <input id="inputValue"></input>
          
          <select name="tokens" id="inputToken">
            <option v-for="token in tokens">{{token}}</option>
          </select>
          
          <div class="col-md-5 pr-md-1">
            
          </div>
          <input id="outputValue"></input>
          <select name="tokens" id="outputToken">
            <option v-for="token in tokens">{{token}}</option>
          </select>
          <br>
          <button @click="approveContract()">1. Approve Swap</button><button>2. Swap</button>

    </card>
        <card type="chart">
          <template slot="header">
            <h3 class="card-title"><i class="tim-icons icon-coins"></i> TokenB Liquidity Pool</h3>
          </template>
          <input id="inputValue"></input>
          
          <select name="tokens" id="inputToken">
            <option v-for="token in tokens">{{token}}</option>
          </select>
          
          <div class="col-md-5 pr-md-1">
            
          </div>
          <input id="outputValue"></input>
          <select name="tokens" id="outputToken">
            <option v-for="token in tokens">{{token}}</option>
          </select>
          <br>
          <button @click="approveContract()">1. Approve Swap</button><button>2. Swap</button>

    </card>
    </div>
</template>
<script>
  import LineChart from '@/components/Charts/LineChart';
  import BarChart from '@/components/Charts/BarChart';
  import * as chartConfigs from '@/components/Charts/config';
  import TaskList from './Dashboard/TaskList';
  import UserTable from './Dashboard/UserTable';
  import config from '@/config';
  import routerContractInfo from './../plugins/abis.js'

  const Web3 = require("web3");

  export default {
    components: {
      LineChart,
      BarChart,
      TaskList,
      UserTable
    },
    watch: {
      inputValue: function(){
        console.log(this.inputToken);
        if (this.inputToken == this.tokens[0] && this.outputToken == this.tokens[1]){ //tokenA to tokenB
          this.outputValue=2*this.inputValue;
        } else if (this.inputToken == this.tokens[1] && this.outputToken == this.tokens[0]){ //tokenB to tokenA
          this.outputValue = 0.5*this.inputValue;
        }
      }
    },
    data() {
      return {
        tokens: [
          'tokenA', 'tokenB'
        ],
        routerContract:{
            chainId: 31,
            address: null,
            abi: null
        },
        tokenA: {
            address: '0x47D137Eb5aa84094B8A79BdDC6a8d07b1F0AD413',
            abi: JSON.parse('[  {   "inputs": [    {     "internalType": "uint256",     "name": "initialSupply",     "type": "uint256"    }   ],   "stateMutability": "nonpayable",   "type": "constructor"  },  {   "anonymous": false,   "inputs": [    {     "indexed": true,     "internalType": "address",     "name": "owner",     "type": "address"    },    {     "indexed": true,     "internalType": "address",     "name": "spender",     "type": "address"    },    {     "indexed": false,     "internalType": "uint256",     "name": "value",     "type": "uint256"    }   ],   "name": "Approval",   "type": "event"  },  {   "anonymous": false,   "inputs": [    {     "indexed": true,     "internalType": "address",     "name": "from",     "type": "address"    },    {     "indexed": true,     "internalType": "address",     "name": "to",     "type": "address"    },    {     "indexed": false,     "internalType": "uint256",     "name": "value",     "type": "uint256"    }   ],   "name": "Transfer",   "type": "event"  },  {   "inputs": [    {     "internalType": "address",     "name": "owner",     "type": "address"    },    {     "internalType": "address",     "name": "spender",     "type": "address"    }   ],   "name": "allowance",   "outputs": [    {     "internalType": "uint256",     "name": "",     "type": "uint256"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [    {     "internalType": "address",     "name": "spender",     "type": "address"    },    {     "internalType": "uint256",     "name": "amount",     "type": "uint256"    }   ],   "name": "approve",   "outputs": [    {     "internalType": "bool",     "name": "",     "type": "bool"    }   ],   "stateMutability": "nonpayable",   "type": "function"  },  {   "inputs": [    {     "internalType": "address",     "name": "account",     "type": "address"    }   ],   "name": "balanceOf",   "outputs": [    {     "internalType": "uint256",     "name": "",     "type": "uint256"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [],   "name": "decimals",   "outputs": [    {     "internalType": "uint8",     "name": "",     "type": "uint8"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [    {     "internalType": "address",     "name": "spender",     "type": "address"    },    {     "internalType": "uint256",     "name": "subtractedValue",     "type": "uint256"    }   ],   "name": "decreaseAllowance",   "outputs": [    {     "internalType": "bool",     "name": "",     "type": "bool"    }   ],   "stateMutability": "nonpayable",   "type": "function"  },  {   "inputs": [],   "name": "getValue",   "outputs": [    {     "internalType": "string",     "name": "",     "type": "string"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [    {     "internalType": "address",     "name": "spender",     "type": "address"    },    {     "internalType": "uint256",     "name": "addedValue",     "type": "uint256"    }   ],   "name": "increaseAllowance",   "outputs": [    {     "internalType": "bool",     "name": "",     "type": "bool"    }   ],   "stateMutability": "nonpayable",   "type": "function"  },  {   "inputs": [],   "name": "name",   "outputs": [    {     "internalType": "string",     "name": "",     "type": "string"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [],   "name": "symbol",   "outputs": [    {     "internalType": "string",     "name": "",     "type": "string"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [],   "name": "totalSupply",   "outputs": [    {     "internalType": "uint256",     "name": "",     "type": "uint256"    }   ],   "stateMutability": "view",   "type": "function"  },  {   "inputs": [    {     "internalType": "address",     "name": "recipient",     "type": "address"    },    {     "internalType": "uint256",     "name": "amount",     "type": "uint256"    }   ],   "name": "transfer",   "outputs": [    {     "internalType": "bool",     "name": "",     "type": "bool"    }   ],   "stateMutability": "nonpayable",   "type": "function"  },  {   "inputs": [    {     "internalType": "address",     "name": "sender",     "type": "address"    },    {     "internalType": "address",     "name": "recipient",     "type": "address"    },    {     "internalType": "uint256",     "name": "amount",     "type": "uint256"    }   ],   "name": "transferFrom",   "outputs": [    {     "internalType": "bool",     "name": "",     "type": "bool"    }   ],   "stateMutability": "nonpayable",   "type": "function"  } ]')
        },
        outputValue:null,
        
      }
    },
    
    methods: {
     approveContract: function(){
        console.log('APROVE FUNCTION');

        if (window.ethereum) {
            web3 = new Web3(window.ethereum);
            web3.eth.net.getId().then(x=>{
                if (x != this.routerContract.chainId){
                    alert('Change metamask wallet chain and repeat');
                } else {
                    this.routerContract.address = '0xf55c496bb1058690DB1401c4b9C19F3f44374961';
                    this.routerContract.abi = JSON.parse('[{"inputs": [{"internalType": "address","name": "_factory","type": "address"},{"internalType": "address",         "name": "_WETH",         "type": "address"       }     ],     "stateMutability": "nonpayable",     "type": "constructor"   },   {     "inputs": [],     "name": "WETH",     "outputs": [       {         "internalType": "address",         "name": "",         "type": "address"       }     ],     "stateMutability": "view",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "tokenA",         "type": "address"       },       {         "internalType": "address",         "name": "tokenB",         "type": "address"       },       {         "internalType": "uint256",         "name": "amountADesired",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountBDesired",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountAMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountBMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "addLiquidity",     "outputs": [       {         "internalType": "uint256",         "name": "amountA",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountB",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "token",         "type": "address"       },       {         "internalType": "uint256",         "name": "amountTokenDesired",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountTokenMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETHMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "addLiquidityETH",     "outputs": [       {         "internalType": "uint256",         "name": "amountToken",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETH",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       }     ],     "stateMutability": "payable",     "type": "function"   },   {     "inputs": [],     "name": "factory",     "outputs": [       {         "internalType": "address",         "name": "",         "type": "address"       }     ],     "stateMutability": "view",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOut",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "reserveIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "reserveOut",         "type": "uint256"       }     ],     "name": "getAmountIn",     "outputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       }     ],     "stateMutability": "pure",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "reserveIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "reserveOut",         "type": "uint256"       }     ],     "name": "getAmountOut",     "outputs": [       {         "internalType": "uint256",         "name": "amountOut",         "type": "uint256"       }     ],     "stateMutability": "pure",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOut",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       }     ],     "name": "getAmountsIn",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "view",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       }     ],     "name": "getAmountsOut",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "view",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountA",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "reserveA",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "reserveB",         "type": "uint256"       }     ],     "name": "quote",     "outputs": [       {         "internalType": "uint256",         "name": "amountB",         "type": "uint256"       }     ],     "stateMutability": "pure",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "tokenA",         "type": "address"       },       {         "internalType": "address",         "name": "tokenB",         "type": "address"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountAMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountBMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "removeLiquidity",     "outputs": [       {         "internalType": "uint256",         "name": "amountA",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountB",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "token",         "type": "address"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountTokenMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETHMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "removeLiquidityETH",     "outputs": [       {         "internalType": "uint256",         "name": "amountToken",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETH",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "token",         "type": "address"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountTokenMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETHMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "removeLiquidityETHSupportingFeeOnTransferTokens",     "outputs": [       {         "internalType": "uint256",         "name": "amountETH",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "token",         "type": "address"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountTokenMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETHMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       },       {         "internalType": "bool",         "name": "approveMax",         "type": "bool"       },       {         "internalType": "uint8",         "name": "v",         "type": "uint8"       },       {         "internalType": "bytes32",         "name": "r",         "type": "bytes32"       },       {         "internalType": "bytes32",         "name": "s",         "type": "bytes32"       }     ],     "name": "removeLiquidityETHWithPermit","outputs": [{"internalType": "uint256","name": "amountToken","type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETH",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "token",         "type": "address"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountTokenMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountETHMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       },       {         "internalType": "bool",         "name": "approveMax",         "type": "bool"       },       {         "internalType": "uint8",         "name": "v",         "type": "uint8"       },       {         "internalType": "bytes32",         "name": "r",         "type": "bytes32"       },       {         "internalType": "bytes32",         "name": "s",         "type": "bytes32"       }     ],     "name": "removeLiquidityETHWithPermitSupportingFeeOnTransferTokens",     "outputs": [       {         "internalType": "uint256",         "name": "amountETH",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "address",         "name": "tokenA",         "type": "address"       },       {         "internalType": "address",         "name": "tokenB",         "type": "address"       },       {         "internalType": "uint256",         "name": "liquidity",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountAMin",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountBMin",         "type": "uint256"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       },       {         "internalType": "bool",         "name": "approveMax",         "type": "bool"       },       {         "internalType": "uint8",         "name": "v",         "type": "uint8"       },       {         "internalType": "bytes32",         "name": "r",         "type": "bytes32"       },       {         "internalType": "bytes32",         "name": "s",         "type": "bytes32"       }     ],     "name": "removeLiquidityWithPermit",     "outputs": [       {         "internalType": "uint256",         "name": "amountA",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountB",         "type": "uint256"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOut",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapETHForExactTokens",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "payable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOutMin",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapExactETHForTokens",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "payable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOutMin",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapExactETHForTokensSupportingFeeOnTransferTokens",     "outputs": [],     "stateMutability": "payable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountOutMin",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapExactTokensForETH",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountOutMin",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapExactTokensForETHSupportingFeeOnTransferTokens",     "outputs": [],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountOutMin",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapExactTokensForTokens",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountIn",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountOutMin",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapExactTokensForTokensSupportingFeeOnTransferTokens",     "outputs": [],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOut",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountInMax",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapTokensForExactETH",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "inputs": [       {         "internalType": "uint256",         "name": "amountOut",         "type": "uint256"       },       {         "internalType": "uint256",         "name": "amountInMax",         "type": "uint256"       },       {         "internalType": "address[]",         "name": "path",         "type": "address[]"       },       {         "internalType": "address",         "name": "to",         "type": "address"       },       {         "internalType": "uint256",         "name": "deadline",         "type": "uint256"       }     ],     "name": "swapTokensForExactTokens",     "outputs": [       {         "internalType": "uint256[]",         "name": "amounts",         "type": "uint256[]"       }     ],     "stateMutability": "nonpayable",     "type": "function"   },   {     "stateMutability": "payable",     "type": "receive"   } ]');
                    var that = this;
                    var defaultAccount;
                        window.ethereum.enable().then(function(){
                            web3.eth.getAccounts(function(err, result){
                                if (err){
                                    alert(err);
                                } else {
                                    defaultAccount = result[0];
                                    //alert(that.tokenA.address);

                                    
                                    var contractTokenA = new web3.eth.Contract(that.tokenA.abi, that.tokenA.address.toString().toLowerCase());
                    
                                    contractTokenA.methods.getValue().call().then(function(result){
                                    if (result){
                                        alert(result);
                                    }
                                    });
                                }
                            })
                        })
                    

                    var contract = new web3.eth.Contract(this.routerContract.abi, this.routerContract.address);
                    //contract.methods.addLiquidityETH(this.tokenA,)
                }
            })
        } else {
        alert('No web3? You should consider trying MetaMask!');
    }
     },

    },
    
  };
</script>
<style>
</style>
